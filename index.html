<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <title>PLANET CHAOS · EXPANDED · 2026</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            background: #000;
            height: 100%;
            font-family: 'Courier New', monospace;
            color: #0af;
            overflow: hidden;
        }

        /* Header Elements */
        #hud {
            position: absolute;
            top: 16px;
            left: 16px;
            font-size: 14px;
            opacity: 0.8;
            letter-spacing: 1px;
            pointer-events: none;
            z-index: 20;
        }

        #status {
            position: absolute;
            top: 36px;
            left: 16px;
            font-size: 12px;
            opacity: 0.7;
            color: #0f0;
            pointer-events: none;
            z-index: 20;
        }

        /* 12 Months Navigation */
        #months-nav {
            position: absolute;
            top: 70px;
            left: 16px;
            width: 100px;
            font-size: 12px;
            line-height: 1.8;
            z-index: 30;
        }

        #months-nav a {
            display: block;
            color: #0af;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.2s;
        }

        #months-nav a:hover {
            color: #fff;
            text-shadow: 0 0 5px #0af;
        }

        /* Data Column */
        #data {
            position: absolute;
            top: 70px;
            left: 140px;
            right: 16px;
            bottom: 16px;
            font-size: 11px;
            line-height: 0.95;
            letter-spacing: -1px;
            word-spacing: -2px;
            overflow-y: auto;
            color: #0f0;
            display: grid;
            grid-template-columns: auto auto;
            justify-content: start;
            gap: 32px;
        }

        /* Heatmap - Moved down to align with Weather (top: 70px) */
        #heatmap {
            position: absolute;
            top: 70px;
            left: 550px;
            display: flex;
            flex-wrap: wrap;
            width: 180px;
            gap: 2px;
            z-index: 10;
            pointer-events: none;
            opacity: 0.9;
        }

        .heatcell {
            width: 14px;
            height: 14px;
            background: #0f0;
            border: 1px solid #333;
        }

        #clock {
            position: absolute;
            bottom: 16px;
            right: 16px;
            font-size: 11px;
            opacity: 0.5;
            color: #6cf;
            text-align: right;
            pointer-events: none;
            line-height: 1.3;
        }

        .category {
            margin: 10px 0 2px 0;
            font-size: 13px;
            color: #0af;
            font-weight: bold;
            grid-column: span 2;
            border-bottom: 1px solid #0af3;
            padding-bottom: 2px;
            letter-spacing: normal;
        }

        .row {
            white-space: pre;
            opacity: 0.9;
            margin-bottom: 0px;
        }

        .label {
            color: #6cf;
        }

        .val {
            font-weight: bold;
        }

        .val-safe {
            color: #0f0;
        }

        .val-watch {
            color: #ffd700;
        }

        .val-warn {
            color: #ff8c00;
        }

        .val-danger {
            color: #f00;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #001122;
        }

        ::-webkit-scrollbar-thumb {
            background: #004466;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #006699;
        }

        /* Mobile Version Preparation */
        @media (max-width: 800px) {
            #months-nav {
                top: 60px;
                left: 16px;
                width: calc(100% - 32px);
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                font-size: 11px;
                line-height: 1.2;
            }

            #months-nav a {
                display: inline-block;
                margin-right: 5px;
            }

            #heatmap {
                top: 110px;
                left: 16px;
            }

            #data {
                top: 300px;
                left: 16px;
                right: 16px;
                grid-template-columns: 1fr;
                gap: 10px;
            }

            ::-webkit-scrollbar {
                width: 4px;
            }
        }
    </style>
</head>

<body>
    <div id="hud">Lavanda.audit.ibonarium.project.2026.february.EXPANDED</div>
    <div id="status">ініціалізація...</div>
    <div id="heatmap"></div>

    <!-- 12 Months Navigation -->
    <div id="months-nav">
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">JANUARY</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">FEBRUARY</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">MARCH</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">APRIL</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">MAY</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">JUNE</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">JULY</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">AUGUST</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">SEPTEMBER</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">OCTOBER</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">NOVEMBER</a>
        <a href="https://lavandaaudit.github.io/radio_underground.signal-off-grid/#">DECEMBER</a>
    </div>

    <div id="data">завантаження...</div>
    <div id="clock">—</div>

    <script>
        const dataDiv = document.getElementById('data');
        const statusDiv = document.getElementById('status');
        const clockDiv = document.getElementById('clock');
        const heatmapDiv = document.getElementById('heatmap');
        const proxy = 'https://corsproxy.io/?';
        const startTime = Date.now();
        let heatmapValues = [];

        function formatRelativeTime(ms) {
            const s = Math.floor(ms / 1000);
            if (s < 60) return `${s}s`;
            const m = Math.floor(s / 60);
            const sec = s % 60;
            return `${m}m ${sec}s`;
        }

        function updateClock() {
            const now = new Date();
            clockDiv.innerHTML = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}<br>${formatRelativeTime(Date.now() - startTime)}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        function getColorClass(value, thresholds) {
            if (value === '--' || value === null) return 'val-safe';
            if (!thresholds) return 'val-safe';
            value = parseFloat(value);
            if (isNaN(value)) return 'val-safe';
            if (thresholds.danger !== undefined && value >= thresholds.danger) return 'val-danger';
            if (thresholds.warn !== undefined && value >= thresholds.warn) return 'val-warn';
            if (thresholds.watch !== undefined && value >= thresholds.watch) return 'val-watch';
            return 'val-safe';
        }

        function getColor(value, thresholds) {
            const cls = getColorClass(value, thresholds);
            switch (cls) {
                case 'val-safe': return '#0f0';
                case 'val-watch': return '#ffd700';
                case 'val-warn': return '#ff8c00';
                case 'val-danger': return '#f00';
                default: return '#0f0';
            }
        }

        function updateHeatmap() {
            heatmapDiv.innerHTML = '';
            heatmapValues.forEach(val => {
                const cell = document.createElement('div');
                cell.className = 'heatcell';
                cell.style.background = val.color;
                heatmapDiv.appendChild(cell);
            });
        }

        // SMART FETCH
        async function fetchSmart(url) {
            try {
                const res = await fetch(url);
                if (res.ok) return await res.json();
            } catch (e) { }
            try {
                const res = await fetch(proxy + encodeURIComponent(url));
                if (res.ok) return await res.json();
            } catch (e) { }
            return null;
        }

        // Fallback specifically for Yahoo/Others
        async function fetchWithProxy(url) {
            try {
                const res = await fetch(proxy + encodeURIComponent(url));
                if (res.ok) return await res.json();
            } catch (e) { }
            return null;
        }

        async function fetchAllData() {
            statusDiv.innerHTML = 'оновлення даних...';
            let html = '';
            let loaded = 0;
            heatmapValues = [];

            // =========================================================================================
            // 1. ПОГОДА
            // =========================================================================================
            html += '<div class="category">ПОГОДА (KYIV)</div>';
            const weather = await fetchSmart('https://api.open-meteo.com/v1/forecast?latitude=50.45&longitude=30.52&current=temperature_2m,relative_humidity_2m,pressure_msl,wind_speed_10m,wind_direction_10m,precipitation,weather_code,is_day');
            if (weather?.current) {
                const w = weather.current;
                const wMetrics = [
                    { label: 'Temperature', value: w.temperature_2m, thresholds: { watch: 30, warn: 35, danger: 40 }, unit: ' °C' },
                    { label: 'Humidity', value: w.relative_humidity_2m, thresholds: { watch: 80, warn: 90, danger: 95 }, unit: ' %' },
                    { label: 'Pressure', value: w.pressure_msl, thresholds: { watch: 1020, warn: 1030, danger: 1040 }, unit: ' hPa' },
                    { label: 'Wind Speed', value: w.wind_speed_10m, thresholds: { watch: 15, warn: 20, danger: 25 }, unit: ' km/h' },
                    { label: 'Precipitation', value: w.precipitation, thresholds: { watch: 1, warn: 5, danger: 10 }, unit: ' mm' },
                ];
                wMetrics.forEach(m => {
                    html += `<div class="row"><span class="label">${m.label} </span><span class="val ${getColorClass(m.value, m.thresholds)}">${m.value}${m.unit}</span></div>`;
                    heatmapValues.push({ value: m.value, color: getColor(m.value, m.thresholds) });
                });
                loaded += wMetrics.length;
            } else {
                html += `<div class="row"><span class="label">Status </span><span class="val val-warn">Connection Error</span></div>`;
            }

            // =========================================================================================
            // 2. ПОВІТРЯ
            // =========================================================================================
            html += '<div class="category">ПОВІТРЯ</div>';
            const air = await fetchSmart('https://air-quality-api.open-meteo.com/v1/air-quality?latitude=50.45&longitude=30.52&current=pm10,pm2_5,carbon_monoxide,ozone,european_aqi,nitrogen_dioxide,sulphur_dioxide,aerosol_optical_depth,dust,uv_index,alder_pollen,birch_pollen,grass_pollen,mugwort_pollen,olive_pollen,ragweed_pollen');
            if (air?.current) {
                const a = air.current;
                const airMetrics = [
                    { label: 'European AQI', value: a.european_aqi, thresholds: { watch: 51, warn: 101, danger: 151 } },
                    { label: 'PM10', value: a.pm10, thresholds: { watch: 46, warn: 121, danger: 196 }, unit: ' µg/m³' },
                    { label: 'PM2.5', value: a.pm2_5, thresholds: { watch: 16, warn: 51, danger: 91 }, unit: ' µg/m³' },
                    { label: 'CO', value: a.carbon_monoxide ? a.carbon_monoxide / 1000 : null, thresholds: { watch: 5, warn: 10, danger: 20 }, unit: ' mg/m³' },
                    { label: 'O₃', value: a.ozone, thresholds: { watch: 101, warn: 121, danger: 161 }, unit: ' µg/m³' },
                    { label: 'NO2', value: a.nitrogen_dioxide ?? 12, thresholds: { watch: 40, warn: 90, danger: 120 }, unit: ' µg/m³' },
                    { label: 'SO2', value: a.sulphur_dioxide ?? 5, thresholds: { watch: 20, warn: 80, danger: 100 }, unit: ' µg/m³' },
                    { label: 'AOD', value: a.aerosol_optical_depth ?? 0.1, thresholds: { watch: 0.2, warn: 0.5, danger: 1.0 }, unit: '' },
                    { label: 'Dust', value: a.dust ?? 10, thresholds: { watch: 20, warn: 50, danger: 100 }, unit: ' µg/m³' },
                    { label: 'UV Index', value: a.uv_index ?? 3, thresholds: { watch: 3, warn: 6, danger: 8 }, unit: '' },
                    { label: 'Pollen(Birch)', value: a.birch_pollen ?? 0, thresholds: { watch: 10, warn: 50, danger: 100 }, unit: ' gr/m³' },
                    { label: 'Pollen(Grass)', value: a.grass_pollen ?? 0, thresholds: { watch: 10, warn: 50, danger: 100 }, unit: ' gr/m³' },
                    { label: 'Pollen(Ambrosia)', value: a.ragweed_pollen ?? 0, thresholds: { watch: 10, warn: 50, danger: 100 }, unit: ' gr/m³' }
                ];
                airMetrics.forEach(m => {
                    html += `<div class="row"><span class="label">${m.label} </span><span class="val ${getColorClass(m.value, m.thresholds)}">${m.value !== null ? m.value : '--'}${m.unit ?? ''}</span></div>`;
                    heatmapValues.push({ value: m.value, color: getColor(m.value, m.thresholds) });
                });
                loaded += airMetrics.length;
            }

            // =========================================================================================
            // 3. КОСМОС
            // =========================================================================================
            html += '<div class="category">КОСМОС</div>';
            const plasma = await fetchWithProxy('https://services.swpc.noaa.gov/products/solar-wind/plasma-7-day.json');
            if (plasma?.length > 1) {
                let lastValid = plasma.slice().reverse().find(r => !isNaN(parseFloat(r[3])) && parseFloat(r[3]) > 0);
                if (lastValid) {
                    const plasmaMetrics = [
                        { label: 'Solar Wind Speed', value: parseFloat(lastValid[3]), thresholds: { watch: 500, warn: 700, danger: 900 }, unit: ' km/s' },
                        { label: 'Solar Wind Density', value: parseFloat(lastValid[6]), thresholds: { watch: 15, warn: 30, danger: 50 }, unit: ' /cm³' },
                        { label: 'Solar Wind Temp', value: parseFloat(lastValid[7]) / 1000, thresholds: { watch: 100, warn: 300, danger: 500 }, unit: ' kK' },
                        { label: 'Mag Field Bt', value: parseFloat(lastValid[2]), thresholds: { watch: 5, warn: 10, danger: 20 }, unit: ' nT' },
                        { label: 'Mag Field Bz', value: parseFloat(lastValid[8]), thresholds: { watch: 5, warn: 10, danger: 20 }, unit: ' nT' },
                        { label: 'Solar Phi', value: parseFloat(lastValid[10]) ?? 0, thresholds: null, unit: ' °' }
                    ];
                    plasmaMetrics.forEach(m => {
                        html += `<div class="row"><span class="label">${m.label} </span><span class="val ${getColorClass(m.value, m.thresholds)}">${isNaN(m.value) ? '--' : m.value.toFixed(1)}${m.unit ?? ''}</span></div>`;
                        heatmapValues.push({ value: isNaN(m.value) ? 0 : m.value, color: getColor(m.value, m.thresholds) });
                    });
                    loaded += plasmaMetrics.length;
                }
            }

            const kpData = await fetchWithProxy('https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json');
            if (kpData?.length) {
                const lastKp = parseFloat(kpData[kpData.length - 1][1]) || 0;
                html += `<div class="row"><span class="label">Kp-index </span><span class="val ${getColorClass(lastKp, { watch: 5, warn: 6, danger: 7 })}">${lastKp}</span></div>`;
                heatmapValues.push({ value: lastKp, color: getColor(lastKp, { watch: 5, warn: 6, danger: 7 }) });
                loaded++;
                for (let i = 2; i <= 6; i++) {
                    let val = parseFloat(kpData[kpData.length - i][1]) || 0;
                    html += `<div class="row"><span class="label">Kp T-${i - 1} </span><span class="val ${getColorClass(val, { watch: 5, warn: 6, danger: 7 })}">${val}</span></div>`;
                    heatmapValues.push({ value: val, color: getColor(val, { watch: 5, warn: 6, danger: 7 }) });
                }
                loaded += 5;
            }

            const dst = await fetchWithProxy('https://services.swpc.noaa.gov/products/kyoto-dst.json');
            if (dst?.length > 0) {
                const lastDst = parseFloat(dst[dst.length - 1][1]) || 0;
                html += `<div class="row"><span class="label">Dst Index </span><span class="val ${getColorClass(-lastDst, { watch: 50, warn: 100, danger: 200 })}">${lastDst} nT</span></div>`;
                heatmapValues.push({ value: lastDst, color: getColor(-lastDst, { watch: 50, warn: 100, danger: 200 }) });
                loaded++;
                for (let i = 2; i <= 6; i++) {
                    let val = parseFloat(dst[dst.length - i][1]) || 0;
                    html += `<div class="row"><span class="label">Prev Dst-${i - 1} </span><span class="val ${getColorClass(-val, { watch: 50, warn: 100, danger: 200 })}">${val} nT</span></div>`;
                    heatmapValues.push({ value: val, color: getColor(-val, { watch: 50, warn: 100, danger: 200 }) });
                }
                loaded += 5;
            }

            const xray = await fetchWithProxy('https://services.swpc.noaa.gov/json/goes/primary/xray-flares-latest.json');
            if (xray?.length > 0) {
                let latest = xray[0];
                html += `<div class="row"><span class="label">X-ray Flare </span><span class="val">${latest.flux ?? '--'} ${latest.class_type ?? ''}</span></div>`;
                heatmapValues.push({ value: latest.flux ?? 0, color: '#ffd700' });
                loaded++;
                for (let i = 1; i < 6 && i < xray.length; i++) {
                    html += `<div class="row"><span class="label">Prev X-ray ${i} </span><span class="val">${xray[i].class_type ?? '--'}</span></div>`;
                    heatmapValues.push({ value: 0, color: '#ffd700' });
                }
                loaded += 5;
            }

            // =========================================================================================
            // 4. ВОДА (GLOBAL & BLACK SEA) - UPDATED
            // =========================================================================================
            html += '<div class="category">ВОДА (GLOBAL)</div>';

            // Use a simpler, clearer set of coordinates for improved reliability
            const waterPoints = [
                { name: 'Black Sea', lat: 43.0, lon: 34.0 }, // Slightly more central black sea
                { name: 'Mediterranean', lat: 35.0, lon: 18.0 },
                { name: 'North Atlantic', lat: 45.0, lon: -30.0 },
                { name: 'Pacific Ocean', lat: 20.0, lon: -155.0 }
            ];

            for (const wp of waterPoints) {
                const wData = await fetchSmart(`https://marine-api.open-meteo.com/v1/marine?latitude=${wp.lat}&longitude=${wp.lon}&current=wave_height,sea_surface_temperature`);
                if (wData?.current) {
                    const wm = wData.current;
                    html += `<div class="row"><span class="label">${wp.name} Temp </span><span class="val ${getColorClass(wm.sea_surface_temperature, { watch: 25, warn: 30, danger: 32 })}">${wm.sea_surface_temperature}°C</span></div>`;
                    html += `<div class="row"><span class="label">${wp.name} Wave </span><span class="val ${getColorClass(wm.wave_height, { watch: 2, warn: 4, danger: 6 })}">${wm.wave_height}m</span></div>`;
                    heatmapValues.push({ value: wm.sea_surface_temperature, color: getColor(wm.sea_surface_temperature, { watch: 25, warn: 30, danger: 32 }) });
                    loaded++;
                }
            }

            // =========================================================================================
            // 5. ЕНЕРГІЯ
            // =========================================================================================
            html += '<div class="category">ЕНЕРГІЯ</div>';
            const commodities = [
                { symbol: 'CL=F', name: 'WTI Oil' },
                { symbol: 'BZ=F', name: 'Brent Oil' },
                { symbol: 'NG=F', name: 'Natural Gas' },
                { symbol: 'GC=F', name: 'Gold' },
                { symbol: 'SI=F', name: 'Silver' },
                { symbol: 'HG=F', name: 'Copper' },
                { symbol: 'PL=F', name: 'Platinum' },
                { symbol: 'PA=F', name: 'Palladium' },
                { symbol: 'ALI=F', name: 'Aluminum', fallback: true },
                { symbol: 'RB=F', name: 'Gasoline RBOB' }
            ];

            for (const c of commodities) {
                if (c.fallback) continue;
                const dat = await fetchWithProxy(`https://query1.finance.yahoo.com/v8/finance/chart/${c.symbol}?range=1d&interval=1d`);
                if (dat?.chart?.result?.[0]?.meta?.regularMarketPrice) {
                    const val = dat.chart.result[0].meta.regularMarketPrice;
                    html += `<div class="row"><span class="label">${c.name} </span><span class="val">${val.toFixed(2)} $</span></div>`;
                    heatmapValues.push({ value: val, color: '#0f0' });
                    loaded++;
                }
            }

            // 6. АГРО
            html += '<div class="category">АГРО (FUTURES)</div>';
            const agro = [
                { symbol: 'ZC=F', name: 'Corn' },
                { symbol: 'ZW=F', name: 'Wheat' },
                { symbol: 'ZS=F', name: 'Soybean' },
                { symbol: 'SB=F', name: 'Sugar' },
                { symbol: 'KC=F', name: 'Coffee' },
                { symbol: 'CC=F', name: 'Cocoa' },
                { symbol: 'CT=F', name: 'Cotton' }
            ];
            for (const c of agro) {
                const dat = await fetchWithProxy(`https://query1.finance.yahoo.com/v8/finance/chart/${c.symbol}?range=1d&interval=1d`);
                if (dat?.chart?.result?.[0]?.meta?.regularMarketPrice) {
                    const val = dat.chart.result[0].meta.regularMarketPrice;
                    html += `<div class="row"><span class="label">${c.name} </span><span class="val">${val.toFixed(2)}</span></div>`;
                    heatmapValues.push({ value: val, color: '#ffd700' });
                    loaded++;
                }
            }

            // 7. ЗЕМЛЕТРУСИ
            html += '<div class="category">ЗЕМЛЕТРУСИ</div>';
            const quakes = await fetchSmart('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson');
            if (quakes?.features) {
                quakes.features.slice(0, 10).forEach((q, i) => {
                    const mag = q.properties.mag || 0;
                    const place = (q.properties.place || 'Unknown').substring(0, 20);
                    html += `<div class="row"><span class="label">M${mag.toFixed(1)} </span><span class="val ${getColorClass(mag, { watch: 4, warn: 5, danger: 6 })}">${place}</span></div>`;
                    heatmapValues.push({ value: mag, color: getColor(mag, { watch: 4, warn: 5, danger: 6 }) });
                    loaded++;
                });
            }

            // 8. ФІНАНСИ & КРИПТА
            html += '<div class="category">ФІНАНСИ & CRYPTO</div>';
            const cryptoIds = 'bitcoin,ethereum,cardano,solana,ripple,litecoin,binancecoin,polkadot,chainlink,dash,monero,dogecoin,shiba-inu,uniswap,avalanche-2,cosmos';
            const crypto = await fetchWithProxy(`https://api.coingecko.com/api/v3/simple/price?ids=${cryptoIds}&vs_currencies=usd`);

            if (crypto) {
                const manualOrder = ['bitcoin', 'ethereum', 'solana', 'binancecoin', 'ripple', 'cardano', 'dogecoin', 'avalanche-2', 'shiba-inu', 'polkadot', 'chainlink', 'litecoin', 'uniswap', 'monero', 'cosmos', 'dash'];
                manualOrder.forEach(key => {
                    if (crypto[key]) {
                        const val = crypto[key].usd;
                        const displayVal = val < 1 ? val.toFixed(6) : val.toFixed(2);
                        html += `<div class="row"><span class="label">${key.toUpperCase()} USD </span><span class="val">${displayVal}</span></div>`;
                        heatmapValues.push({ value: val, color: '#0f0' });
                        loaded++;
                    }
                });
            }

            const sp500 = await fetchSmart('https://query1.finance.yahoo.com/v8/finance/chart/^GSPC?range=1d&interval=1d');
            if (sp500?.chart?.result?.[0]?.meta?.regularMarketPrice) {
                const val = sp500.chart.result[0].meta.regularMarketPrice;
                html += `<div class="row"><span class="label">S&P 500 </span><span class="val">${val.toFixed(2)}</span></div>`;
                heatmapValues.push({ value: val, color: '#0f0' });
                loaded++;
            }

            const nasdaq = await fetchSmart('https://query1.finance.yahoo.com/v8/finance/chart/^IXIC?range=1d&interval=1d');
            if (nasdaq?.chart?.result?.[0]?.meta?.regularMarketPrice) {
                const val = nasdaq.chart.result[0].meta.regularMarketPrice;
                html += `<div class="row"><span class="label">NASDAQ </span><span class="val">${val.toFixed(2)}</span></div>`;
                heatmapValues.push({ value: val, color: '#0f0' });
                loaded++;
            }

            // 9. ВАЛЮТИ
            html += '<div class="category">ВАЛЮТИ</div>';
            const cbRates = await fetchWithProxy('https://api.coinbase.com/v2/exchange-rates?currency=USD');
            if (cbRates?.data?.rates) {
                const rates = cbRates.data.rates;
                const currencies = [
                    { label: 'USD → EUR', val: rates.EUR },
                    { label: 'USD → GBP', val: rates.GBP },
                    { label: 'USD → JPY', val: rates.JPY },
                    { label: 'USD → CAD', val: rates.CAD },
                    { label: 'USD → AUD', val: rates.AUD },
                    { label: 'USD → CHF', val: rates.CHF },
                    { label: 'USD → CNY', val: rates.CNY },
                    { label: 'USD → UAH', val: rates.UAH },
                    { label: 'USD → RUB', val: rates.RUB, dim: true }
                ];
                currencies.forEach(m => {
                    const rateVal = parseFloat(m.val);
                    const val = rateVal ? rateVal.toFixed(4) : '--';
                    html += `<div class="row"><span class="label" style="${m.dim ? 'opacity:0.5' : ''}">${m.label} </span><span class="val">${val}</span></div>`;
                    heatmapValues.push({ value: rateVal || 0, color: '#0f0' });
                });
                loaded += currencies.length;
            }

            dataDiv.innerHTML = html || '<div>немає даних</div>';
            statusDiv.innerHTML = `оновлено (${loaded} джерел) • ${new Date().toLocaleTimeString()}`;
            updateHeatmap();
        }

        fetchAllData();
        setInterval(fetchAllData, 60000); 
    </script>
</body>

</html>
